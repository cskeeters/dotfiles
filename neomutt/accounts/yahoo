# vim: filetype=neomuttrc

unmailboxes *

# Important!!!
set move = no

set sidebar_new_mail_only = no

set folder = "~/.mail/yahoo"
set mbox_type = Maildir

# set spoolfile = "+Inbox"
set postponed = "+Draft"
# set record    = "+Sent"
set trash     = "+Trash"

set spoolfile = "notmuch://?query=tag:inbox"

# Don't copy email, let mbsync download it via IMAP or we'll have duplicates
set copy = no
unset record
set nm_record = no

mailboxes +Inbox +Sent +Draft +Bulk +Archive +Trash

# in/out mail servers
set realname = "Chad Skeeters"
set smtp_url = "smtps://smtp.mail.yahoo.com:465/"

set smtp_authenticators = "login"
source "~/.mutt_yahoo_cred"
# set smtp_user = "goobsoft@yahoo.com"
# set smtp_pass = "..."

set from = "goobsoft@yahoo.com"
set use_envelope_from
set use_from = "yes"

# Tell neomutt where the notmuch DB is for this account
set nm_default_url = "notmuch:///Users/chad/.mail/yahoo"

# When reading the disk, ignore files and folders that start with .
set mask = "!^\\.[^.]"

# NAVIGATE

macro index,pager gi "<change-folder>notmuch://?query=tag:inbox<enter>" "Go Inbox (notmuch)"
macro index,pager gr "<change-folder>notmuch://?query=tag:archive<enter>" "Go Archive (notmuch)"
macro index,pager ga "<change-folder>notmuch://?query=not tag:spam and not tag:trash<enter>" "Go All (notmuch)"
macro index,pager gt "<change-folder>notmuch://?query=tag:sent<enter>" "Go Sent (notmuch)"
macro index,pager gs "<change-folder>notmuch://?query=tag:spam<enter>" "Go SPAM (notmuch Bulk)"
macro index,pager gd "<change-folder>notmuch://?query=tag:trash<enter>" "Go Trash"

# Map '/' to Notmuch Global Search
bind index / vfolder-from-query

# PROCESS

macro index,pager ! "<modify-labels-then-hide>-inbox +spam<enter><save-message>+Bulk<enter><next-entry>" "Mark as Spam"
# One could use folder-hook to make this smarter, but this works
macro index,pager I "<modify-labels-then-hide>-spam -archive +inbox<enter><save-message>+Inbox<enter><next-entry>" "Move to Inbox"

macro index,pager E "<modify-labels-then-hide>+archive -inbox<enter><save-message>+Archive<enter><next-entry>" "Archive"

macro index,pager D "<modify-labels-then-hide>-inbox -spam -archive +trash<enter><save-message>+Trash<enter><purge-message><next-entry>" "Trash"

bind index "X" noop # Unbind the default first
macro index,pager X "<pipe-message>~/bin/notmuch-rm<enter><refresh>" "Remove from MailDir(s) with FZF"

#macro index,pager M "<modify-labels>" "Manually modify labels" # WARN: Works only on vfolders

# These commands work on vfolders and Maildirs
macro index,pager l "<pipe-message>~/bin/notmuch-tag -a<enter><refresh>" "Add Labels with FZF"
macro index,pager L "<pipe-message>~/bin/notmuch-tag -r<enter><refresh>" "Remove Labels with FZF"
macro index,pager M "<pipe-message>~/bin/notmuch-tag -m<enter><refresh>" "Set Labels with FZF"


# SYNC

# Get mailboxes with `mbsync -ls`
# macro index G "<shell-escape>mbsync -a && notmuch new<enter>" "Sync & Index Mail"
# macro index,pager u "<shell-escape>mbsync yahoo:INBOX yahoo:Sent yahoo:Bulk > /dev/null 2>&1 && notmuch new > /dev/null 2>&1 && notify-send 'NeoMutt' 'Sync Complete!' &<enter>" "Sync and Update Notmuch (Linux)"
# macro index,pager u "<shell-escape>mbsync yahoo:INBOX yahoo:Sent yahoo:Bulk > /dev/null 2>&1 && notmuch new > /dev/null 2>&1 && osascript -e 'display notification \"Sync Complete\" with title \"NeoMutt\"' &<enter>" "Sync and Update Notmuch (macOS)"
# macro index,pager gu "<shell-escape>sync-yahoo &<enter>" "Sync and Update Notmuch"
# macro index,pager gU "<shell-escape>sync-yahoo -f &<enter>" "Full Sync and Update Notmuch"
macro index,pager gu "<shell-escape>sync-mail yahoo INBOX Sent &<enter>" "Sync and Update Notmuch"
macro index,pager gU "<shell-escape>sync-mail yahoo INBOX Sent Trash Draft Bulk Archive &<enter>" "Full Sync and Update Notmuch"
