# vim: filetype=neomuttrc

## SETTINGS


### User

set real_name = "Chad Skeeters"
# set signature = "~/.signature-yahoo"
set signature = ""

set use_from = yes # Ensures the "From:" header
set from = "goobsoft@yahoo.com"


### Index

# %4C Message number (4 digits)
# %Z %{combined-flags}
# Two spaces after %* ensures one space
set index_format = "%4C %Z %-20.20n %s %*   %g %-7.7b %[%Y-%b-%d, %a]" # Comment next to debug Maildir/Notmuch
set index_format = "%4C %Z %-20.20n %s %*  %g %[%Y-%b-%d, %a]"


### Maildir

# Setup for `y` Navigation
set folder = "~/.mail/yahoo"
set mbox_type = Maildir

set move = no # DONT move read messages from spool_file to mbox

# Don't copy email, let mbsync download it via IMAP or we'll have duplicates
set copy = no
unset record
set nm_record = no

# Ensure the Return-Path is goobsoft@yahoo.com
set use_envelope_from
# set envelope_from_address = "goobsoft@yahoo.com"  # If unset, it will use the address specified in the From: header.

unmailboxes *    # Clear mailboxes from other.  These are watched by neomutt
mailboxes +Inbox +Sent +Draft +Bulk +Archive +Trash
# When reading the disk, ignore files and folders that start with .
set mask = "!^\\.[^.]"

# This tells neomutt what vfolder to start with
set spool_file = "notmuch://?query=tag:inbox"    # Renamed from spoolfile
# set spool_file = "+Inbox"
set postponed = "+Draft"
# set record    = "+Sent"
set trash     = "+Trash"


### Notmuch

# Tell neomutt where the notmuch DB is for this account
# set nm_default_url = "notmuch:///Users/chad/.mail/yahoo"
set nm_config_profile = "yahoo"



### SMTP

set smtp_url = "smtps://smtp.mail.yahoo.com:465/"
set smtp_authenticators = "login" # Doesn't work on macOS without this set to login (??)
source "~/.mutt_yahoo_cred" # Keep credentials outside dotfiles



## MAPPINGS


### Navigate

macro index,pager gi "<change-folder>notmuch://?query=tag:inbox<enter>" "Go Inbox (notmuch)"
macro index,pager gr "<change-folder>notmuch://?query=tag:archive<enter>" "Go Archive (notmuch)"
macro index,pager ga "<change-folder>notmuch://?query=not tag:spam and not tag:trash<enter>" "Go All (notmuch)"
macro index,pager gt "<change-folder>notmuch://?query=tag:sent<enter>" "Go Sent (notmuch)"
macro index,pager gs "<change-folder>notmuch://?query=tag:spam<enter>" "Go SPAM (notmuch Bulk)"
macro index,pager gd "<change-folder>notmuch://?query=tag:trash<enter>" "Go Trash"

# Map '/' to Notmuch Global Search
bind index / vfolder-from-query


### Process

macro index,pager ! "<modify-labels-then-hide>-inbox +spam<enter><save-message>+Bulk<enter><next-entry>" "Mark as Spam"
macro index,pager I "<modify-labels-then-hide>-spam -archive +inbox<enter><save-message>+Inbox<enter><next-entry>" "Move to Inbox"  # One could use folder-hook to make this smarter, but this works
macro index,pager E "<modify-labels-then-hide>+archive -inbox<enter><save-message>+Archive<enter><next-entry>" "Archive"
macro index,pager D "<modify-labels-then-hide>-inbox -spam -archive +trash<enter><save-message>+Trash<enter><purge-message><next-entry>" "Trash"
bind index "X" noop # Unbind the default first
macro index,pager X "<pipe-message>NOTMUCH_PROFILE=$nm_config_profile ~/bin/notmuch-rm<enter><refresh>" "Remove from MailDir(s) with FZF"


### Tag/Label

# These commands work on vfolders and Maildirs
#macro index,pager M "<modify-labels>" "Manually modify labels" # WARN: Works only on vfolders
macro index,pager l "<pipe-message>NOTMUCH_PROFILE=$nm_config_profile ~/bin/notmuch-tag -a<enter><refresh>" "Add Labels with FZF"
macro index,pager L "<pipe-message>NOTMUCH_PROFILE=$nm_config_profile ~/bin/notmuch-tag -r<enter><refresh>" "Remove Labels with FZF"
macro index,pager M "<pipe-message>NOTMUCH_PROFILE=$nm_config_profile ~/bin/notmuch-tag -m<enter><refresh>" "Set Labels with FZF"


### Sync

# Get mailboxes with `mbsync -ls`
macro index,pager gu "<shell-escape>NOTMUCH_PROFILE=$nm_config_profile sync-mail yahoo INBOX Sent &<enter>" "Sync and Update Notmuch"
macro index,pager gU "<shell-escape>NOTMUCH_PROFILE=$nm_config_profile sync-mail yahoo INBOX Sent Trash Draft Bulk Archive &<enter>" "Full Sync and Update Notmuch"
